<!-- Angular Component Reset Password - Styles et scripts gérés dans angular.json -->
<!-- Preloader -->
<div class="preloader">
  <img src="assets/images/logos/logo_societe.png" alt="loader" class="lds-ripple img-fluid" width="80" />
</div>
<div id="main-wrapper" class="auth-customizer-none">
  <div class="position-relative overflow-hidden radial-gradient min-vh-100 w-100 d-flex align-items-center justify-content-center">
    <div class="d-flex align-items-center justify-content-center w-100">
      <div class="row justify-content-center w-100">
        <div class="col-md-8 col-lg-6 col-xxl-3 auth-card">
          <div class="card mb-0">
            <div class="card-body pt-5">
              <a routerLink="/" class="text-nowrap logo-img text-center d-block mb-3 w-100">
                <img src="assets/images/logos/logo_societe.png" width="180" alt="Velosi ERP" />
              </a>
              
              <!-- Slogan de la société -->
              <div class="text-center mb-4">
                
                <p class="text-muted fs-5 mb-0">Votre partenaire de confiance</p>
                <p class="text-muted fs-6 mb-0">Transport & Logistique</p>
              </div>
              
              <!-- Message d'information avec animation -->
              <div class="text-center mb-4 p-4 rounded-3 bg-light-warning border border-warning-subtle">
                <div class="mb-3">
                  <iconify-icon icon="solar:shield-keyhole-minimalistic-bold-duotone" 
                                class="fs-7 text-warning animate__animated animate__pulse animate__infinite"></iconify-icon>
                </div>
                <h5 class="fw-semibold text-dark mb-2">Nouveau mot de passe</h5>
                <p class="mb-0 text-muted fs-4">
                  Créez un nouveau mot de passe sécurisé pour votre compte Velosi ERP. 
                  Votre mot de passe doit être fort et unique.
                </p>
              </div>
              
              <!-- Formulaire de réinitialisation -->
              <form (ngSubmit)="onSubmit()" #resetForm="ngForm">
                <!-- Champ Nouveau mot de passe -->
                <div class="mb-3">
                  <label for="newPassword" class="form-label fw-semibold">
                    <iconify-icon icon="solar:lock-bold" class="me-2 text-primary"></iconify-icon>
                    Nouveau mot de passe
                  </label>
                  <div class="input-group">
                    <span class="input-group-text bg-light-primary">
                      <iconify-icon icon="solar:lock-linear" class="text-primary"></iconify-icon>
                    </span>
                    <input [type]="showPassword ? 'text' : 'password'" 
                           class="form-control ps-3" 
                           id="newPassword" 
                           name="newPassword" 
                           [(ngModel)]="resetData.newPassword" 
                           required 
                           minlength="8"
                           placeholder="Minimum 8 caractères"
                           (input)="checkPasswordStrength()">
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            (click)="togglePasswordVisibility()">
                      <iconify-icon [icon]="showPassword ? 'solar:eye-closed-linear' : 'solar:eye-linear'"></iconify-icon>
                    </button>
                  </div>
                  
                  <!-- Indicateur de force du mot de passe -->
                  <div class="mt-2" *ngIf="resetData.newPassword">
                    <div class="progress" style="height: 4px;">
                      <div class="progress-bar" 
                           [ngClass]="getPasswordStrengthClass()" 
                           [style.width]="passwordStrength + '%'"></div>
                    </div>
                    <small class="text-muted">
                      Force: <span [ngClass]="getPasswordStrengthTextClass()">{{ getPasswordStrengthText() }}</span>
                    </small>
                  </div>
                </div>
                
                <!-- Champ Confirmer mot de passe -->
                <div class="mb-4">
                  <label for="confirmPassword" class="form-label fw-semibold">
                    <iconify-icon icon="solar:lock-bold" class="me-2 text-primary"></iconify-icon>
                    Confirmer le mot de passe
                  </label>
                  <div class="input-group">
                    <span class="input-group-text bg-light-primary">
                      <iconify-icon icon="solar:shield-check-linear" class="text-primary"></iconify-icon>
                    </span>
                    <input [type]="showConfirmPassword ? 'text' : 'password'" 
                           class="form-control ps-3" 
                           id="confirmPassword" 
                           name="confirmPassword" 
                           [(ngModel)]="resetData.confirmPassword" 
                           required 
                           placeholder="Ressaisissez votre mot de passe"
                           [class.is-invalid]="resetData.confirmPassword && !passwordsMatch()"
                           [class.is-valid]="resetData.confirmPassword && passwordsMatch()">
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            (click)="toggleConfirmPasswordVisibility()">
                      <iconify-icon [icon]="showConfirmPassword ? 'solar:eye-closed-linear' : 'solar:eye-linear'"></iconify-icon>
                    </button>
                  </div>
                  
                  <!-- Message de validation -->
                  <div class="mt-1">
                    <small *ngIf="resetData.confirmPassword && !passwordsMatch()" class="text-danger">
                      <iconify-icon icon="solar:close-circle-linear" class="me-1"></iconify-icon>
                      Les mots de passe ne correspondent pas
                    </small>
                    <small *ngIf="resetData.confirmPassword && passwordsMatch()" class="text-success">
                      <iconify-icon icon="solar:check-circle-linear" class="me-1"></iconify-icon>
                      Les mots de passe correspondent
                    </small>
                  </div>
                </div>
                
                <!-- Critères de sécurité -->
                <div class="mb-4 p-3 rounded-3 bg-light border">
                  <h6 class="fw-semibold mb-2 text-dark">
                    <iconify-icon icon="solar:shield-check-bold" class="me-2 text-success"></iconify-icon>
                    Critères de sécurité
                  </h6>
                  <div class="row">
                    <div class="col-6">
                      <small [class]="hasMinLength() ? 'text-success' : 'text-muted'">
                        <iconify-icon [icon]="hasMinLength() ? 'solar:check-circle-bold' : 'solar:close-circle-linear'" class="me-1"></iconify-icon>
                        8+ caractères
                      </small>
                    </div>
                    <div class="col-6">
                      <small [class]="hasUpperCase() ? 'text-success' : 'text-muted'">
                        <iconify-icon [icon]="hasUpperCase() ? 'solar:check-circle-bold' : 'solar:close-circle-linear'" class="me-1"></iconify-icon>
                        Majuscule
                      </small>
                    </div>
                    <div class="col-6">
                      <small [class]="hasLowerCase() ? 'text-success' : 'text-muted'">
                        <iconify-icon [icon]="hasLowerCase() ? 'solar:check-circle-bold' : 'solar:close-circle-linear'" class="me-1"></iconify-icon>
                        Minuscule
                      </small>
                    </div>
                    <div class="col-6">
                      <small [class]="hasNumber() ? 'text-success' : 'text-muted'">
                        <iconify-icon [icon]="hasNumber() ? 'solar:check-circle-bold' : 'solar:close-circle-linear'" class="me-1"></iconify-icon>
                        Chiffre
                      </small>
                    </div>
                  </div>
                </div>
                
                <!-- Boutons d'action -->
                <div class="d-grid gap-2 mb-3">
                  <button type="submit" 
                          class="btn btn-primary py-3 rounded-3 fw-semibold" 
                          [disabled]="!resetForm.valid || !passwordsMatch() || isResetting">
                    <span *ngIf="!isResetting">
                      <iconify-icon icon="solar:shield-keyhole-bold" class="me-2"></iconify-icon>
                      Réinitialiser le mot de passe
                    </span>
                    <span *ngIf="isResetting">
                      <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                      Réinitialisation...
                    </span>
                  </button>
                </div>
                
                <!-- Lien retour login -->
                <div class="text-center">
                  <a routerLink="/login" 
                     class="btn bg-light-secondary text-secondary w-100 py-3 rounded-3 fw-medium">
                    <iconify-icon icon="solar:alt-arrow-left-bold" class="me-2"></iconify-icon>
                    Retour à la connexion
                  </a>
                </div>
              </form>
              
              <!-- Message de succès -->
              <div *ngIf="resetSuccess" class="alert alert-success mt-3 rounded-3">
                <div class="d-flex align-items-center">
                  <iconify-icon icon="solar:check-circle-bold" class="fs-6 me-2"></iconify-icon>
                  <div>
                    <strong>Mot de passe réinitialisé !</strong><br>
                    <small>Redirection vers la connexion...</small>
                  </div>
                </div>
              </div>
              
              <!-- Message d'erreur -->
              <div *ngIf="errorMessage" class="alert alert-danger mt-3 rounded-3">
                <div class="d-flex align-items-center">
                  <iconify-icon icon="solar:danger-circle-bold" class="fs-6 me-2"></iconify-icon>
                  <div>
                    <strong>Erreur :</strong><br>
                    <small>{{ errorMessage }}</small>
                  </div>
                </div>
              </div>
              
              <!-- Information de sécurité -->
              <div class="text-center mt-4">
                <div class="border-top pt-3">
                  <p class="text-muted fs-4 mb-0">
                    <iconify-icon icon="solar:shield-check-linear" class="me-1 text-success"></iconify-icon>
                    Processus sécurisé • Vos données sont protégées
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
